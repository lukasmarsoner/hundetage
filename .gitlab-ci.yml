image: cirrusci/flutter

variables:
before_script:
- flutter channel beta
- flutter upgrade

stages:
- test
- deploy

unit_test:
  image: hundetage
  stage: test
  script:
  - flutter test --coverage
  - genhtml coverage/lcov.info --output=coverage
  artifacts:
    paths:
  - coverage/

pages:
  image: alpine
  stage: deploy
  dependencies:
  - unit_test
  script:
  - mkdir public
  - mv coverage/ public/coverage/
  artifacts:
    paths:
    - public
  only:
  - master