image: cirrusci/flutter

before_script:
- flutter doctor
- flutter channel stable
- flutter packages get

stages:
- test
- coverage

UnitWidgetTests:
  stage: test
  script:
  - flutter test --coverage
  artifacts:
    paths:
    - coverage


coverage:
  stage: coverage
  image: ubuntu:16.04
  coverage: '/^\s+lines.+: (\d+.\d*%)/'
  dependencies:
  - UnitWidgetTests
  script:
  - genhtml -o coverage coverage/lcov.info
  - flutter test test/user_settings_test.dart